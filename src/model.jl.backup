using ModelingToolkit
using ModelingToolkit: t_nounits as t, D_nounits as D

"""
    GongBetaAdrenergicSignaling Model

ModelingToolkit.jl implementation of the Gong et al. (2020) beta-adrenergic signaling model.

Reference:
Quantitative analysis of variability in an integrated model of human ventricular
electrophysiology and β-adrenergic signaling by Jingqi Q.X. Gong, Monica E. Susilo,
Anna Sher, Cynthia J. Musante, Eric A. Sobie
DOI: https://doi.org/10.1016/j.yjmcc.2020.04.009

Adapted from:
- https://github.com/JQXGong/Ohara-beta-adrenergic
- https://github.com/finsberg/torord-trauma

The model includes:
- 57 state variables representing G-protein signaling, cAMP dynamics, PKA activation,
  PDE phosphorylation, PP1 inhibition, and substrate phosphorylation
- 167 parameters with default values from the reference implementation
- 3 cellular compartments: caveolar (cav), extracaveolar (eca), and cytosolic (cyt)

# Usage
```julia
using GongBetaAdrenergicSignaling
using ModelingToolkit, OrdinaryDiffEq

# Create model with default parameters and initial conditions
@mtkbuild sys = GongBetaAdrenergic()

# Create ODE problem
prob = ODEProblem(sys, [], (0.0, 10000.0), [])

# Solve
sol = solve(prob, Rodas5P())
```

# Overriding parameters
```julia
# Change isoproterenol concentration
@mtkbuild sys = GongBetaAdrenergic(iso = 1.0)
```
"""
@mtkmodel GongBetaAdrenergic begin
    @parameters begin
        # Isoproterenol concentration
        iso = 0.0, [description = "Isoproterenol concentration (μM)"]

        # Cell geometry
        V_cav = 7.6026542216873e-7, [description = "Caveolar volume"]
        V_eca = 1.52053084433746e-6, [description = "Extracaveolar volume"]
        V_cyt = 2.5772997811519946e-5, [description = "Cytosolic volume"]
        vol_cav = 5.0e1, [description = "Ratio whole/caveolar volume"]
        vol_eca = 2.5e1, [description = "Ratio whole/extracaveolar volume"]
        vol_cyt = 1.4749262536873156, [description = "Ratio whole/cytosolic volume"]

        # cAMP diffusion rates
        k_cav_eca = 7.5e-8, [description = "cAMP diffusion cav-eca"]
        k_cav_cyt = 5.0e-9, [description = "cAMP diffusion cav-cyt"]
        k_eca_cyt = 9.0e-9, [description = "cAMP diffusion eca-cyt"]

        # PKA concentrations and parameters (c[10-29])
        PKA_eca = 1.248e0, [description = "PKA concentration ECAV"]
        PKA_cav = 2.497e1, [description = "PKA concentration CAV"]
        PKA_cyt = 5.001e-1, [description = "PKA concentration CYT"]
        PKI_cav = 4.993e0, [description = "PKI concentration CAV"]
        PKI_eca = 2.497e-1, [description = "PKI concentration ECAV"]
        PKI_cyt = 1.000e-1, [description = "PKI concentration CYT"]

        k_pki_f = 50.0, [description = "PKI forward rate"]
        k_pki_b = 0.01, [description = "PKI backward rate"]
        k_pka_f1 = 100.0, [description = "First cAMP binding forward rate"]
        k_pka_f2 = 100.0, [description = "Second cAMP binding forward rate"]
        k_pka_f3 = 100.0, [description = "C subunit dissociation forward rate"]

        # PKA backward rates for each compartment
        k_pka_cav_b1 = 249.84, [description = "CAV first cAMP backward"]
        k_pka_cav_b2 = 1135.9, [description = "CAV second cAMP backward"]
        k_pka_cav_b3 = 37.55, [description = "CAV C dissociation backward"]
        k_pka_eca_b1 = 249.84, [description = "ECAV first cAMP backward"]
        k_pka_eca_b2 = 1135.9, [description = "ECAV second cAMP backward"]
        k_pka_eca_b3 = 37.55, [description = "ECAV C dissociation backward"]
        k_pka_cyt_b1 = 10.88, [description = "CYT first cAMP backward"]
        k_pka_cyt_b2 = 46.12, [description = "CYT second cAMP backward"]
        k_pka_cyt_b3 = 37.55, [description = "CYT C dissociation backward"]

        # PP1 parameters (c[30-39])
        k_pp1_f = 0.010145, [description = "Inhibitor-1 phosphorylation rate"]
        k_pp1_b = 0.0035731, [description = "Inhibitor-1 dephosphorylation rate"]
        Km_pki = 0.001469, [description = "Inhibitor-1 affinity for PKA"]
        Km_pp2a = 1.9526e-5, [description = "Inhibitor-1 affinity for PP2A"]
        PP1_eca = 0.1, [description = "PP1 concentration ECAV"]
        PP1_cav = 0.25, [description = "PP1 concentration CAV"]
        PP1_cyt = 0.2, [description = "PP1 concentration CYT"]
        Kd_pp1 = 0.001, [description = "PP1-Inhibitor-1 affinity"]
        inhib1_tot = 0.06, [description = "Total Inhibitor-1"]
        PP2A = 1.0, [description = "PP2A concentration"]

        # PDE parameters (c[40-56])
        k_pde2 = 20.0, [description = "PDE2 hydrolysis rate"]
        k_pde3 = 2.5, [description = "PDE3 hydrolysis rate"]
        k_pde4 = 4.0, [description = "PDE4 hydrolysis rate"]
        Km_pde2 = 50.0, [description = "PDE2 affinity"]
        Km_pde3 = 0.8, [description = "PDE3 affinity"]
        Km_pde4 = 1.4, [description = "PDE4 affinity"]
        pde_phos_factor = 3.0, [description = "PDE phosphorylation activity increase"]
        k_pde_phos = 0.0196, [description = "PDE phosphorylation rate"]
        k_pde_dephos = 0.0102, [description = "PDE dephosphorylation rate"]

        PDE2_cav = 0.1032, [description = "PDE2 concentration CAV"]
        PDE2_eca = 1.327e-5, [description = "PDE2 concentration ECAV"]
        PDE2_cyt = 1.820e-2, [description = "PDE2 concentration CYT"]
        PDE3_cav = 0.2377, [description = "PDE3 concentration CAV"]
        PDE3_cyt = 0.1480, [description = "PDE3 concentration CYT"]
        PDE4_cav = 0.2863, [description = "PDE4 concentration CAV"]
        PDE4_eca = 6.713e-4, [description = "PDE4 concentration ECAV"]
        PDE4_cyt = 4.093e-1, [description = "PDE4 concentration CYT"]

        # G-protein parameters (c[57-105])
        Gs_tot = 4.76, [description = "Total Gs protein"]
        Gi_tot = 0.5, [description = "Total Gi protein"]
        f_Gs_eca = 0.5664, [description = "Gs fraction ECAV"]
        f_Gs_cav = 0.0011071, [description = "Gs fraction CAV"]
        f_Gs_cyt = 0.4325, [description = "Gs fraction CYT"]
        f_Gi_cav = 0.85, [description = "Gi fraction CAV"]
        f_Gi_eca = 0.15, [description = "Gi fraction ECAV"]

        # Receptor-ligand binding constants
        Kd_b1_h = 0.062, [description = "β1-AR high affinity"]
        Kd_b1_l = 0.567, [description = "β1-AR low affinity"]
        Kd_b1_gs = 2.449, [description = "β1-AR-Gs affinity"]
        Kd_b2_h = 0.012, [description = "β2-AR high affinity"]
        Kd_b2_h_phos = 0.1, [description = "Phospho-β2-AR high affinity"]
        Kd_b2_l = 1.053, [description = "β2-AR low affinity"]
        Kd_b2_l_phos = 1.053, [description = "Phospho-β2-AR low affinity"]
        Kd_b2_gs = 1.8463, [description = "β2-AR-Gs affinity"]
        Kd_b2_gi = 1.6655, [description = "Phospho-β2-AR-Gi affinity"]

        # G-protein activation/deactivation
        k_gs_hi = 4.9054, [description = "Gs activation by high affinity"]
        k_gs_lo = 0.25945, [description = "Gs activation by low affinity"]
        k_gi_hi = 4.0, [description = "Gi activation by high affinity"]
        k_gi_lo = 0.05, [description = "Gi activation by low affinity"]
        k_gtp_gs = 0.8, [description = "Gs GTPase rate"]
        k_gtp_gi = 0.8, [description = "Gi GTPase rate"]
        k_reassoc_gs = 1210.0, [description = "Gs reassociation rate"]
        k_reassoc_gi = 1210.0, [description = "Gi reassociation rate"]

        # Receptor desensitization
        k_grk_dephos = 0.0003442, [description = "GRK dephosphorylation rate"]
        k_grk_phos = 0.0004655, [description = "GRK phosphorylation rate"]
        k_pka_r_phos = 0.002275, [description = "PKA receptor phosphorylation"]
        k_pka_r_dephos = 0.0003556, [description = "PKA receptor dephosphorylation"]

        # Receptor concentrations and derived constants
        grk_cav = 1.0
        Rb1_tot_cav = 0.4317, [description = "Total β1-AR CAV"]
        beta2_ratio_cav = 1.0
        Rb2_tot_cav = 0.0638, [description = "Total β2-AR CAV"]

        grk_eca = 1.0
        beta2_ratio_eca = 1.0
        Rb2_tot_eca = 9.373e-3, [description = "Total β2-AR ECAV"]
        Rb1_tot_eca = 0.3051, [description = "Total β1-AR ECAV"]

        Rb1_tot_cyt = 0.4546, [description = "Total β1-AR CYT"]
        grk_cyt = 1.0

        # AC parameters (c[106-122])
        hill_ac47 = 1.0043, [description = "AC47 Hill coefficient"]
        hill_ac56 = 1.3574, [description = "AC56 Hill coefficient"]
        hill_gi_ac56 = 0.6623, [description = "Gi-AC56 Hill coefficient"]
        Km_ac47_gs = 0.031544, [description = "AC47-Gs affinity"]
        Km_ac56_gs = 0.0852, [description = "AC56-Gs affinity"]
        Km_ac56_gi = 0.0465, [description = "AC56-Gi affinity"]
        Km_gs_gi_ac56 = 0.4824, [description = "Gs-Gi interaction AC56"]
        basal_ac47 = 0.03135, [description = "AC47 basal activity"]
        basal_ac56 = 0.037696, [description = "AC56 basal activity"]
        amp_ac47 = 3.3757, [description = "AC47 amplification"]
        amp_ac56 = 41.32, [description = "AC56 amplification"]
        gi_inhibition = 0.8569, [description = "Max Gi inhibition"]

        AC56_cyt = 1.226e-3, [description = "AC56 concentration CYT"]
        AC56_cav = 1.300e-2, [description = "AC56 concentration CAV"]
        f_atp = 0.9408, [description = "ATP saturation factor"]
        AC47_eca = 2.046e-3, [description = "AC47 concentration ECAV"]
        AC56_cyt2 = 1.783e-3, [description = "AC56 concentration CYT (type 2)"]

        # Substrate phosphorylation (c[123-163])
        # INaK
        k_inak_phos = 0.015265
        k_inak_dephos = 0.092455
        Km_inak_phos = 0.0011001
        Km_inak_dephos = 5.7392

        # INa
        Km_ina_phos = 0.10988
        Km_ina_dephos = 7.8605
        k_ina_phos = 0.01368
        k_ina_dephos = 0.052811

        # PLB
        k_plb_phos = 0.11348
        k_plb_dephos = 0.48302
        Km_plb_phos = 9.8854e-4
        Km_plb_dephos = 0.80737

        # IKur
        k_ikur_phos = 0.069537
        k_ikur_dephos = 0.317
        Km_ikur_phos = 0.27623
        Km_ikur_dephos = 0.002331

        # IKs
        k_iks_phos = 0.16305
        k_iks_dephos = 1.0542
        Km_iks_phos = 9.9794e-5
        Km_iks_dephos = 1.1147e-4
        IKs_tot = 0.025
        IKs_akap = 5.866e-5
        IKs_tot_akap = 0.025

        # Troponin
        k_tni_phos = 0.10408
        k_tni_dephos = 0.052633
        Km_tni_phos = 2.7143e-5
        Km_tni_dephos = 0.26714

        # RyR
        RyR_tot = 0.125
        k_ryr_phos = 0.0025548
        k_ryr_dephos = 0.0038257
        Km_ryr_phos = 6.6298e-5
        Km_ryr_dephos = 0.043003
        RyR_akap = 4.156e-3
        RyR_tot_akap = 0.125

        # ICaL
        ICaL_tot = 0.025
        k_ical_phos = 5.1009e-4
        k_ical_dephos = 6.903e-4
        Km_ical_phos = 1.2702e-6
        Km_ical_dephos = 0.0063064
        ICaL_akap = 6.223e-4
        ICaL_tot_akap = 0.025

        # Effective fractions for electrophysiology
        fRyR_base = 0.0329
        fICaL_base = 0.0269
        fIKs_base = 0.0306
    end # end of @parameters block

    @variables begin
        # G-protein states (y[0-8])
        beta_cav_Gs_aGTP(t) = 0.00685533455220118, [description = "Gs-αGTP CAV"]
        beta_eca_Gs_aGTP(t) = 0.0184630401160325, [description = "Gs-αGTP ECAV"]
        beta_cyt_Gs_aGTP(t) = 0.000731426797266862, [description = "Gs-αGTP CYT"]
        beta_cav_Gs_bg(t) = 0.00746268345094940, [description = "Gs-βγ CAV"]
        beta_eca_Gs_bg(t) = 0.0191020788696145, [description = "Gs-βγ ECAV"]
        beta_cyt_Gs_bg(t) = 0.00115141961261304, [description = "Gs-βγ CYT"]
        beta_cav_Gs_aGDP(t) = 0.000607348898749425, [description = "Gs-αGDP CAV"]
        beta_eca_Gs_aGDP(t) = 0.000639038753581265, [description = "Gs-αGDP ECAV"]
        beta_cyt_Gs_aGDP(t) = 0.000419992815346110, [description = "Gs-αGDP CYT"]

        # cAMP states (y[9-11])
        cAMP_cav(t) = 0.344257659177271, [description = "cAMP CAV"]
        cAMP_eca(t) = 9.62262190945345, [description = "cAMP ECAV"]
        cAMP_cyt(t) = 0.474028267773051, [description = "cAMP CYT"]

        # β1-AR phosphorylation (y[12-17])
        beta_cav_Rb1_pka_tot(t) = 0.0148474493496437, [description = "β1-AR PKA-phosphorylated CAV"]
        beta_eca_Rb1_pka_tot(t) = 0.203015985725400, [description = "β1-AR PKA-phosphorylated ECAV"]
        beta_cyt_Rb1_pka_tot(t) = 0.00944459882156118, [description = "β1-AR PKA-phosphorylated CYT"]
        beta_cav_Rb1_grk_tot(t) = 1.76916170568022e-10, [description = "β1-AR GRK-phosphorylated CAV"]
        beta_eca_Rb1_grk_tot(t) = 8.36801924219387e-10, [description = "β1-AR GRK-phosphorylated ECAV"]
        beta_cyt_Rb1_grk_tot(t) = 5.01719476559362e-11, [description = "β1-AR GRK-phosphorylated CYT"]

        # PKA states - Caveolar (y[18-22])
        pka_cav_ARC(t) = 0.0898875954193269, [description = "RLC CAV"]
        pka_cav_A2RC(t) = 0.00272422687231002, [description = "L2RC CAV"]
        pka_cav_A2R(t) = 0.225041998219388, [description = "L2R CAV"]
        pka_cav_C(t) = 0.0322381220102320, [description = "C CAV"]
        pka_cav_PKIC(t) = 0.192803876209063, [description = "PKI CAV"]

        # PKA states - Extracaveolar (y[23-27])
        pka_eca_ARC(t) = 0.205457169881723, [description = "RLC ECAV"]
        pka_eca_A2RC(t) = 0.174050238959555, [description = "L2RC ECAV"]
        pka_eca_A2R(t) = 0.817148066343192, [description = "L2R ECAV"]
        pka_eca_C(t) = 0.567236181979005, [description = "C ECAV"]
        pka_eca_PKIC(t) = 0.249911884364108, [description = "PKI ECAV"]

        # PKA states - Cytosolic (y[28-32])
        pka_cyt_ARC(t) = 0.0646981828366729, [description = "RLC CYT"]
        pka_cyt_A2RC(t) = 0.0664977613514265, [description = "L2RC CYT"]
        pka_cyt_A2R(t) = 0.489057632872032, [description = "L2R CYT"]
        pka_cyt_C(t) = 0.362107101574369, [description = "C CYT"]
        pka_cyt_PKIC(t) = 0.126950531297531, [description = "PKI CYT"]

        # PDE phosphorylation (y[33-37])
        PDE3_P_cav(t) = 0.0233954992478800, [description = "PDE3 phosphorylated CAV"]
        PDE3_P_cyt(t) = 0.0128401592747216, [description = "PDE3 phosphorylated CYT"]
        PDE4_P_cav(t) = 0.00629647926927854, [description = "PDE4 phosphorylated CAV"]
        PDE4_P_eca(t) = 4.29166115483698e-05, [description = "PDE4 phosphorylated ECAV"]
        PDE4_P_cyt(t) = 0.00917030613498568, [description = "PDE4 phosphorylated CYT"]

        # PP1 inhibition (y[38])
        inhib1_p(t) = 0.0123536190564101, [description = "Inhibitor-1 phosphorylated"]

        # Substrate phosphorylation (y[39-46])
        ICaLp(t) = 0.000664158274421826, [description = "ICaL phosphorylated fraction"]
        IKsp(t) = 0.000765842738691197, [description = "IKs phosphorylated fraction"]
        iup_f_plb(t) = 0.666165471397222, [description = "PLB phosphorylated fraction"]
        f_tni(t) = 0.673477756497978, [description = "TnI phosphorylated fraction"]
        ina_f_ina(t) = 0.236980176272067, [description = "INa phosphorylated fraction"]
        f_inak(t) = 0.124710628782511, [description = "INaK phosphorylated fraction"]
        RyRp(t) = 0.00404925913372347, [description = "RyR phosphorylated fraction"]
        f_ikur(t) = 0.0589106047787742, [description = "IKur phosphorylated fraction"]

        # β2-AR and Gi states - Caveolar (y[47-51])
        beta_cav_Rb2_pka_tot(t) = 0.0274407333314977, [description = "β2-AR PKA-phosphorylated CAV"]
        beta_cav_Rb2_grk_tot(t) = 6.32124571143896e-10, [description = "β2-AR GRK-phosphorylated CAV"]
        beta_cav_Gi_aGTP(t) = 0.00159025206300466, [description = "Gi-αGTP CAV"]
        beta_cav_Gi_bg(t) = 0.00209267447556971, [description = "Gi-βγ CAV"]
        beta_cav_Gi_aGDP(t) = 0.000502422412564797, [description = "Gi-αGDP CAV"]

        # β2-AR and Gi states - Extracaveolar (y[52-56])
        beta_eca_Rb2_pka_tot(t) = 0.0110248493074472, [description = "β2-AR PKA-phosphorylated ECAV"]
        beta_eca_Rb2_grk_tot(t) = 8.04005829146876e-11, [description = "β2-AR GRK-phosphorylated ECAV"]
        beta_eca_Gi_aGTP(t) = 0.000364313646402573, [description = "Gi-αGTP ECAV"]
        beta_eca_Gi_bg(t) = 0.000705654325530757, [description = "Gi-βγ ECAV"]
        beta_eca_Gi_aGDP(t) = 0.000341340679127998, [description = "Gi-αGDP ECAV"]

        # Intermediate/algebraic variables
        iup_f_plb_clamped(t), [description = "Clamped PLB fraction"]
        f_tni_clamped(t), [description = "Clamped TnI fraction"]
        ina_f_ina_clamped(t), [description = "Clamped INa fraction"]
        f_inak_clamped(t), [description = "Clamped INaK fraction"]
        f_ikur_clamped(t), [description = "Clamped IKur fraction"]

        beta_cav_Rb1_np_tot(t), [description = "Non-phosphorylated β1-AR CAV"]
        beta_cav_Rb2_np_tot(t), [description = "Non-phosphorylated β2-AR CAV"]
        beta_eca_Rb1_np_tot(t), [description = "Non-phosphorylated β1-AR ECAV"]
        beta_eca_Rb2_np_tot(t), [description = "Non-phosphorylated β2-AR ECAV"]
        beta_cyt_Rb1_np_tot(t), [description = "Non-phosphorylated β1-AR CYT"]

        beta_cav_Gi_abg(t), [description = "Gi heterotrimer CAV"]
        beta_cav_Gs_abg(t), [description = "Gs heterotrimer CAV"]
        beta_eca_Gs_abg(t), [description = "Gs heterotrimer ECAV"]
        beta_eca_Gi_abg(t), [description = "Gi heterotrimer ECAV"]
        beta_cyt_Gs_abg(t), [description = "Gs heterotrimer CYT"]

        # Cubic/quadratic solution intermediate variables
        beta_cav_Gs_f_d(t)
        beta_cav_Gs_f_b(t)
        beta_cav_Gs_f_c(t)
        beta_cav_Gs_f_rr(t)
        beta_cav_Gs_f_yr(t)
        beta_cav_Gs_f_yi(t)
        beta_cav_Gs_f_mag(t)
        beta_cav_Gs_f_arg(t)
        beta_cav_Gs_f_x(t)
        beta_cav_Gs_f_r(t)
        beta_cav_Gs_f_i(t)
        beta_cav_Gs_f(t)
        beta_eca_Gs_f_d(t)
        beta_eca_Gs_f_c(t)
        beta_eca_Gs_f_b(t)
        beta_eca_Gs_f_rr(t)
        beta_eca_Gs_f_yi(t)
        beta_eca_Gs_f_yr(t)
        beta_eca_Gs_f_mag(t)
        beta_eca_Gs_f_arg(t)
        beta_eca_Gs_f_x(t)
        beta_eca_Gs_f_i(t)
        beta_eca_Gs_f_r(t)
        beta_eca_Gs_f(t)
        beta_cyt_Rb1_np_f_b(t)
        beta_cyt_Rb1_np_f_c(t)
        sqrt_term_cyt(t)
        Rb1_np_f(t)
        beta_eca_Rb2_pka_f_c(t)
        beta_eca_Rb2_pka_f_b(t)
        sqrt_term_eca(t)
        beta_eca_Rb2_pka_f(t)
        beta_cav_Rb2_pka_f_c(t)
        beta_cav_Rb2_pka_f_b(t)
        sqrt_term_cav(t)
        beta_cav_Rb2_pka_f(t)

        # Receptor forms
        beta_cav_Rb1_f(t)
        beta_cav_LRb1(t)
        beta_cav_LRb1Gs(t)
        beta_cav_Rb1Gs(t)
        beta_cav_Rb2_f(t)
        beta_cav_LRb2(t)
        beta_cav_LRb2Gs(t)
        beta_cav_Rb2Gs(t)
        beta_eca_Rb1_f(t)
        beta_eca_Rb2_f(t)
        beta_eca_LRb1(t)
        beta_eca_LRb2(t)
        beta_eca_LRb2Gs(t)
        beta_eca_LRb1Gs(t)
        beta_eca_Rb2Gs(t)
        beta_eca_Rb1Gs(t)
        beta_eca_RGs_tot(t)
        beta_eca_LRGs_tot(t)
        beta_cyt_Gs_f(t)
        LRb1_np(t)
        LRb1Gs_np(t)
        Rb1Gs_np(t)
        beta_cav_RGs_tot(t)
        beta_cav_LRGs_tot(t)
        beta_cav_Gi_f(t)
        beta_cav_Rb2Gi(t)
        beta_cav_LRb2Gi(t)
        beta_eca_Gi_f(t)
        beta_eca_Rb2Gi(t)
        beta_eca_LRb2Gi(t)

        # PKA and cAMP dynamics
        pka_cav_RCf(t)
        pka_eca_RCf(t)
        pka_cyt_RCf(t)
        pka_cav_dcAMP(t)
        pka_eca_dcAMP(t)
        pka_cyt_dcAMP(t)

        # PDE hydrolysis
        dcAMP_PDE2_cyt(t)
        dcAMP_PDE2_eca(t)
        dcAMP_PDE2_cav(t)
        dcAMP_PDE3_cav(t)
        dcAMP_PDE3_cyt(t)
        dcAMP_PDE4_cyt(t)
        dcAMP_PDE4_eca(t)
        dcAMP_PDE4_cav(t)

        # cAMP compartment dynamics
        camp_cAMP_cyt_pde(t)
        camp_cAMP_cyt_j1(t)
        camp_cAMP_cyt_j2(t)
        camp_cAMP_eca_pde(t)
        camp_cAMP_eca_j2(t)
        camp_cAMP_eca_j1(t)
        camp_cAMP_cav_pde(t)
        camp_cAMP_cav_j2(t)
        camp_cAMP_cav_j1(t)

        # AC activity
        ac_kAC47_cyt_gsa(t)
        kAC47_cyt(t)
        ac_kAC56_cav_gsa(t)
        gsi(t)
        kAC56_cav(t)
        ac_kAC47_eca_gsa(t)
        kAC47_eca(t)
        ac_kAC56_cyt_gsa(t)
        kAC56_cyt(t)
        dcAMP_AC47_cyt(t)
        dcAMP_AC56_cyt(t)
        dcAMP_AC56_cav(t)
        dcAMP_AC47_eca(t)

        # PP1
        pp1_PP1f_cyt_sum(t)
        PP1f_cyt(t)
        di(t)

        # Channel phosphorylation intermediates
        iks_sig_IKsp_dif(t)
        akap_sig_RyRp_dif(t)
        akap_sig_ICaLp_dif(t)

        # Derived constants for cubic equations (depend on iso)
        kf_b2_gi_cav(t)
        kf_b1_cav(t)
        kb_b1_cav(t)
        kf_b2_cav(t)
        kf_b1_eca(t)
        kf_b2_gi_eca(t)
        kb_b2_eca(t)
        kf_b2_eca(t)
        kb_b1_eca(t)
        kf_b1_cyt(t)
    end # end of @variables block

    @equations begin
        # Clamp PKA fractions to [0.0001, 0.9999]
        iup_f_plb_clamped ~ clamp(iup_f_plb, 0.0001, 0.9999)
        f_tni_clamped ~ clamp(f_tni, 0.0001, 0.9999)
        ina_f_ina_clamped ~ clamp(ina_f_ina, 0.0001, 0.9999)
        f_inak_clamped ~ clamp(f_inak, 0.0001, 0.9999)
        f_ikur_clamped ~ clamp(f_ikur, 0.0001, 0.9999)

        # Derived constants (depend on iso) - c[89] through c[105]
        # Caveolar
        kf_b2_gi_cav ~ (Kd_b2_h_phos + iso) * (Kd_b2_l_phos + iso) / Kd_b2_l_phos
        kf_b1_cav ~ Kd_b2_gs * Kd_b2_h * Kd_b1_l * (Kd_b1_h + iso) * (Kd_b2_l + iso)
        kb_b1_cav ~ Kd_b1_l * Kd_b2_l * (Kd_b1_h + iso) * (Kd_b2_h + iso)
        kf_b2_cav ~ Kd_b1_gs * Kd_b2_gs * Kd_b1_h * Kd_b2_h * (Kd_b1_l + iso) * (Kd_b2_l + iso)
        # Extracaveolar (same expressions)
        kb_b2_eca ~ kf_b1_cav
        kf_b2_eca ~ kf_b2_cav
        kb_b1_eca ~ kb_b1_cav
        kf_b2_gi_eca ~ kf_b2_gi_cav
        kf_b1_eca ~ Kd_b1_gs * Kd_b1_h * Kd_b2_l * (Kd_b2_h + iso) * (Kd_b1_l + iso)
        # Cytoplasm
        kf_b1_cyt ~ (Kd_b1_h + iso) * (Kd_b1_l + iso) / Kd_b1_l

        ## CAVEOLAR COMPARTMENT ##
        # Calculate non-phosphorylated receptors
        beta_cav_Rb1_np_tot ~ Rb1_tot_cav - beta_cav_Rb1_pka_tot - beta_cav_Rb1_grk_tot
        beta_cav_Rb2_np_tot ~ Rb2_tot_cav - beta_cav_Rb2_pka_tot - beta_cav_Rb2_grk_tot

        # G-protein heterotrimer concentrations
        beta_cav_Gi_abg ~ f_Gi_cav * Gi_tot * vol_cav - beta_cav_Gi_aGTP - beta_cav_Gi_aGDP
        beta_cav_Gs_abg ~ f_Gs_cav * Gs_tot * vol_cav - beta_cav_Gs_aGTP - beta_cav_Gs_aGDP

        # Solve cubic equation for free Gs using Cardano's method
        beta_cav_Gs_f_d ~ beta_cav_Gs_abg * kf_b2_cav / kb_b1_cav
        beta_cav_Gs_f_b ~ ((kb_b2_eca + kf_b1_eca) / kb_b1_cav +
                           beta_cav_Rb1_np_tot + beta_cav_Rb2_np_tot - beta_cav_Gs_abg)
        beta_cav_Gs_f_c ~ ((kf_b1_eca * (beta_cav_Rb1_np_tot - beta_cav_Gs_abg) +
                            kb_b2_eca * (beta_cav_Rb2_np_tot - beta_cav_Gs_abg) + kf_b2_cav) / kb_b1_cav)

        beta_cav_Gs_f_rr ~ (-beta_cav_Gs_f_d / 27.0 * beta_cav_Gs_f_b^3.0 -
                            beta_cav_Gs_f_b * beta_cav_Gs_f_b * beta_cav_Gs_f_c * beta_cav_Gs_f_c / 108.0 +
                            beta_cav_Gs_f_b * beta_cav_Gs_f_c * beta_cav_Gs_f_d / 6.0 +
                            beta_cav_Gs_f_c^3.0 / 27.0 +
                            beta_cav_Gs_f_d * beta_cav_Gs_f_d / 4.0)

        beta_cav_Gs_f_yr ~ (sqrt(max(0.0, beta_cav_Gs_f_rr)) +
                            beta_cav_Gs_f_d / 2.0 +
                            beta_cav_Gs_f_b * beta_cav_Gs_f_c / 6.0 -
                            beta_cav_Gs_f_b^3.0 / 27.0)

        beta_cav_Gs_f_yi ~ sqrt(max(0.0, -beta_cav_Gs_f_rr))

        beta_cav_Gs_f_mag ~ (beta_cav_Gs_f_yr * beta_cav_Gs_f_yr +
                             beta_cav_Gs_f_yi * beta_cav_Gs_f_yi)^(1.0/6.0)

        beta_cav_Gs_f_arg ~ ifelse(beta_cav_Gs_f_yr != 0,
                                   atan(beta_cav_Gs_f_yi / beta_cav_Gs_f_yr) / 3.0,
                                   0.0)

        beta_cav_Gs_f_x ~ ((beta_cav_Gs_f_c / 3.0 - beta_cav_Gs_f_b * beta_cav_Gs_f_b / 9.0) /
                           (beta_cav_Gs_f_mag * beta_cav_Gs_f_mag))

        beta_cav_Gs_f_r ~ (beta_cav_Gs_f_mag * cos(beta_cav_Gs_f_arg) * (1.0 - beta_cav_Gs_f_x) -
                           beta_cav_Gs_f_b / 3.0)

        beta_cav_Gs_f_i ~ (beta_cav_Gs_f_mag * sin(beta_cav_Gs_f_arg) * (1.0 + beta_cav_Gs_f_x))

        beta_cav_Gs_f ~ sqrt(beta_cav_Gs_f_r * beta_cav_Gs_f_r + beta_cav_Gs_f_i * beta_cav_Gs_f_i)

        # Free and bound receptor forms
        beta_cav_Rb1_f ~ beta_cav_Rb1_np_tot /
                         (1.0 + iso / Kd_b1_l + beta_cav_Gs_f * (Kd_b1_h + iso) / (Kd_b1_gs * Kd_b1_h))

        beta_cav_LRb1 ~ iso * beta_cav_Rb1_f / Kd_b1_l
        beta_cav_LRb1Gs ~ iso * beta_cav_Rb1_f * beta_cav_Gs_f / (Kd_b1_gs * Kd_b1_h)
        beta_cav_Rb1Gs ~ beta_cav_Rb1_f * beta_cav_Gs_f / Kd_b1_gs

        beta_cav_Rb2_f ~ beta_cav_Rb2_np_tot /
                         (1.0 + iso / Kd_b2_l + beta_cav_Gs_f * (Kd_b2_h + iso) / (Kd_b2_gs * Kd_b2_h))

        beta_cav_LRb2 ~ iso * beta_cav_Rb2_f / Kd_b2_l
        beta_cav_LRb2Gs ~ iso * beta_cav_Rb2_f * beta_cav_Gs_f / (Kd_b2_gs * Kd_b2_h)
        beta_cav_Rb2Gs ~ beta_cav_Rb2_f * beta_cav_Gs_f / Kd_b2_gs

        # Receptor phosphorylation by PKA and GRK
        D(beta_cav_Rb1_pka_tot) ~ 0.001 * (k_pka_r_phos * pka_cav_C * beta_cav_Rb1_np_tot -
                                            k_pka_r_dephos * beta_cav_Rb1_pka_tot)

        D(beta_cav_Rb1_grk_tot) ~ 0.001 * (k_grk_phos * grk_cav * (beta_cav_LRb1 + beta_cav_LRb1Gs) -
                                            k_grk_dephos * beta_cav_Rb1_grk_tot)

        D(beta_cav_Rb2_pka_tot) ~ 0.001 * (k_pka_r_phos * pka_cav_C * beta_cav_Rb2_np_tot -
                                            k_pka_r_dephos * beta_cav_Rb2_pka_tot)

        D(beta_cav_Rb2_grk_tot) ~ 0.001 * (k_grk_phos * grk_cav * (beta_cav_LRb2 + beta_cav_LRb2Gs) -
                                            k_grk_dephos * beta_cav_Rb2_grk_tot)

        ## EXTRACAVEOLAR COMPARTMENT ##
        beta_eca_Rb1_np_tot ~ Rb1_tot_eca - beta_eca_Rb1_pka_tot - beta_eca_Rb1_grk_tot
        beta_eca_Rb2_np_tot ~ Rb2_tot_eca - beta_eca_Rb2_pka_tot - beta_eca_Rb2_grk_tot
        beta_eca_Gs_abg ~ f_Gs_eca * Gs_tot * vol_eca - beta_eca_Gs_aGTP - beta_eca_Gs_aGDP

        # Cubic equation for extracaveolar Gs
        beta_eca_Gs_f_d ~ beta_eca_Gs_abg * kf_b2_eca / kb_b1_eca
        beta_eca_Gs_f_c ~ ((kf_b1_cav * (beta_eca_Rb1_np_tot - beta_eca_Gs_abg) +
                            kb_b2_eca * (beta_eca_Rb2_np_tot - beta_eca_Gs_abg) + kf_b2_eca) / kb_b1_eca)
        beta_eca_Gs_f_b ~ ((kb_b2_eca + kf_b1_cav) / kb_b1_eca +
                           beta_eca_Rb1_np_tot + beta_eca_Rb2_np_tot - beta_eca_Gs_abg)

        beta_eca_Gs_f_rr ~ (-beta_eca_Gs_f_d / 27.0 * beta_eca_Gs_f_b^3.0 -
                            beta_eca_Gs_f_b * beta_eca_Gs_f_b * beta_eca_Gs_f_c * beta_eca_Gs_f_c / 108.0 +
                            beta_eca_Gs_f_b * beta_eca_Gs_f_c * beta_eca_Gs_f_d / 6.0 +
                            beta_eca_Gs_f_c^3.0 / 27.0 +
                            beta_eca_Gs_f_d * beta_eca_Gs_f_d / 4.0)

        beta_eca_Gs_f_yi ~ sqrt(max(0.0, -beta_eca_Gs_f_rr))
        beta_eca_Gs_f_yr ~ (sqrt(max(0.0, beta_eca_Gs_f_rr)) +
                            beta_eca_Gs_f_d / 2.0 +
                            beta_eca_Gs_f_b * beta_eca_Gs_f_c / 6.0 -
                            beta_eca_Gs_f_b^3.0 / 27.0)

        beta_eca_Gs_f_mag ~ (beta_eca_Gs_f_yr * beta_eca_Gs_f_yr +
                             beta_eca_Gs_f_yi * beta_eca_Gs_f_yi)^(1.0/6.0)

        beta_eca_Gs_f_arg ~ ifelse(beta_eca_Gs_f_yr != 0,
                                   atan(beta_eca_Gs_f_yi / beta_eca_Gs_f_yr) / 3.0,
                                   0.0)

        beta_eca_Gs_f_x ~ ((beta_eca_Gs_f_c / 3.0 - beta_eca_Gs_f_b * beta_eca_Gs_f_b / 9.0) /
                           (beta_eca_Gs_f_mag * beta_eca_Gs_f_mag))

        beta_eca_Gs_f_i ~ (beta_eca_Gs_f_mag * sin(beta_eca_Gs_f_arg) * (1.0 + beta_eca_Gs_f_x))
        beta_eca_Gs_f_r ~ (beta_eca_Gs_f_mag * cos(beta_eca_Gs_f_arg) * (1.0 - beta_eca_Gs_f_x) -
                           beta_eca_Gs_f_b / 3.0)

        beta_eca_Gs_f ~ sqrt(beta_eca_Gs_f_r * beta_eca_Gs_f_r + beta_eca_Gs_f_i * beta_eca_Gs_f_i)

        beta_eca_Rb1_f ~ beta_eca_Rb1_np_tot /
                         (1.0 + iso / Kd_b1_l + beta_eca_Gs_f * (Kd_b1_h + iso) / (Kd_b1_gs * Kd_b1_h))

        beta_eca_Rb2_f ~ beta_eca_Rb2_np_tot /
                         (1.0 + iso / Kd_b2_l + beta_eca_Gs_f * (Kd_b2_h + iso) / (Kd_b2_gs * Kd_b2_h))

        beta_eca_LRb1 ~ iso * beta_eca_Rb1_f / Kd_b1_l
        beta_eca_LRb2 ~ iso * beta_eca_Rb2_f / Kd_b2_l
        beta_eca_LRb2Gs ~ iso * beta_eca_Rb2_f * beta_eca_Gs_f / (Kd_b2_gs * Kd_b2_h)
        beta_eca_LRb1Gs ~ iso * beta_eca_Rb1_f * beta_eca_Gs_f / (Kd_b1_gs * Kd_b1_h)
        beta_eca_Rb2Gs ~ beta_eca_Rb2_f * beta_eca_Gs_f / Kd_b2_gs
        beta_eca_Rb1Gs ~ beta_eca_Rb1_f * beta_eca_Gs_f / Kd_b1_gs
        beta_eca_RGs_tot ~ beta_eca_Rb1Gs + beta2_ratio_eca * beta_eca_Rb2Gs
        beta_eca_LRGs_tot ~ beta_eca_LRb1Gs + beta2_ratio_eca * beta_eca_LRb2Gs

        # Gi protein binding
        beta_eca_Gi_abg ~ f_Gi_eca * Gi_tot * vol_eca - beta_eca_Gi_aGTP - beta_eca_Gi_aGDP

        beta_eca_Rb2_pka_f_c ~ -beta_eca_Rb2_pka_tot * Kd_b2_gi * Kd_b2_h_phos
        beta_eca_Rb2_pka_f_b ~ (beta_eca_Gi_abg * (iso + Kd_b2_h_phos) -
                                beta_eca_Rb2_pka_tot * (Kd_b2_h_phos + iso) +
                                Kd_b2_gi * Kd_b2_h_phos * (1.0 + iso / Kd_b2_l_phos))
        sqrt_term_eca ~ beta_eca_Rb2_pka_f_b^2 - 4.0 * kf_b2_gi_eca * beta_eca_Rb2_pka_f_c
        beta_eca_Rb2_pka_f ~ (-beta_eca_Rb2_pka_f_b + sqrt(max(0.0, sqrt_term_eca))) / (2.0 * kf_b2_gi_eca)

        D(beta_eca_Rb1_pka_tot) ~ 0.001 * (k_pka_r_phos * pka_eca_C * beta_eca_Rb1_np_tot -
                                            k_pka_r_dephos * beta_eca_Rb1_pka_tot)

        D(beta_eca_Rb1_grk_tot) ~ 0.001 * (k_grk_phos * grk_eca * (beta_eca_LRb1 + beta_eca_LRb1Gs) -
                                            k_grk_dephos * beta_eca_Rb1_grk_tot)

        D(beta_eca_Rb2_pka_tot) ~ 0.001 * (k_pka_r_phos * pka_eca_C * beta_eca_Rb2_np_tot -
                                            k_pka_r_dephos * beta_eca_Rb2_pka_tot)

        D(beta_eca_Rb2_grk_tot) ~ 0.001 * (k_grk_phos * grk_eca * (beta_eca_LRb2 + beta_eca_LRb2Gs) -
                                            k_grk_dephos * beta_eca_Rb2_grk_tot)

        ## CYTOPLASM COMPARTMENT ##
        beta_cyt_Gs_abg ~ f_Gs_cyt * Gs_tot * vol_cyt - beta_cyt_Gs_aGTP - beta_cyt_Gs_aGDP
        beta_cyt_Rb1_np_tot ~ Rb1_tot_cyt - beta_cyt_Rb1_pka_tot - beta_cyt_Rb1_grk_tot

        # Quadratic solution for cytoplasmic Rb1
        beta_cyt_Rb1_np_f_b ~ (beta_cyt_Gs_abg * (Kd_b1_h + iso) -
                               beta_cyt_Rb1_np_tot * (Kd_b1_h + iso) +
                               Kd_b1_gs * Kd_b1_h * (1.0 + iso / Kd_b1_l))
        beta_cyt_Rb1_np_f_c ~ -beta_cyt_Rb1_np_tot * Kd_b1_h * Kd_b1_gs
        sqrt_term_cyt ~ beta_cyt_Rb1_np_f_b^2 - 4.0 * kf_b1_cyt * beta_cyt_Rb1_np_f_c
        Rb1_np_f ~ (-beta_cyt_Rb1_np_f_b + sqrt(max(0.0, sqrt_term_cyt))) / (2.0 * kf_b1_cyt)

        beta_cyt_Gs_f ~ beta_cyt_Gs_abg / (1.0 + Rb1_np_f / Kd_b1_gs * (1.0 + iso / Kd_b1_h))
        LRb1_np ~ iso * Rb1_np_f / Kd_b1_l
        LRb1Gs_np ~ iso * Rb1_np_f * beta_cyt_Gs_f / (Kd_b1_gs * Kd_b1_h)
        Rb1Gs_np ~ beta_cyt_Gs_f * Rb1_np_f / Kd_b1_gs

        D(beta_cyt_Rb1_pka_tot) ~ 0.001 * (k_pka_r_phos * pka_cyt_C * beta_cyt_Rb1_np_tot -
                                            k_pka_r_dephos * beta_cyt_Rb1_pka_tot)

        D(beta_cyt_Rb1_grk_tot) ~ 0.001 * (k_grk_phos * grk_cyt * (LRb1_np + LRb1Gs_np) -
                                            k_grk_dephos * beta_cyt_Rb1_grk_tot)

        ## G-PROTEIN ACTIVATION ##
        beta_cav_RGs_tot ~ beta_cav_Rb1Gs + beta2_ratio_cav * beta_cav_Rb2Gs
        beta_cav_LRGs_tot ~ beta_cav_LRb1Gs + beta2_ratio_cav * beta_cav_LRb2Gs

        beta_cav_Rb2_pka_f_c ~ -beta_cav_Rb2_pka_tot * Kd_b2_gi * Kd_b2_h_phos
        beta_cav_Rb2_pka_f_b ~ (beta_cav_Gi_abg * (iso + Kd_b2_h_phos) -
                                beta_cav_Rb2_pka_tot * (Kd_b2_h_phos + iso) +
                                Kd_b2_gi * Kd_b2_h_phos * (1.0 + iso / Kd_b2_l_phos))
        sqrt_term_cav ~ beta_cav_Rb2_pka_f_b^2 - 4.0 * kf_b2_gi_cav * beta_cav_Rb2_pka_f_c
        beta_cav_Rb2_pka_f ~ (-beta_cav_Rb2_pka_f_b + sqrt(max(0.0, sqrt_term_cav))) / (2.0 * kf_b2_gi_cav)

        beta_cav_Gi_f ~ beta_cav_Gi_abg / (1.0 + beta_cav_Rb2_pka_f / Kd_b2_gi * (1.0 + iso / Kd_b2_h_phos))
        beta_cav_Rb2Gi ~ beta_cav_Rb2_pka_f * beta_cav_Gi_f / Kd_b2_gi
        beta_cav_LRb2Gi ~ beta_cav_Rb2Gi * iso / Kd_b2_h_phos

        beta_eca_Gi_f ~ beta_eca_Gi_abg / (1.0 + beta_eca_Rb2_pka_f / Kd_b2_gi * (1.0 + iso / Kd_b2_h_phos))
        beta_eca_Rb2Gi ~ beta_eca_Rb2_pka_f * beta_eca_Gi_f / Kd_b2_gi
        beta_eca_LRb2Gi ~ iso / Kd_b2_h_phos * beta_eca_Rb2Gi

        # Gs activation
        D(beta_cav_Gs_aGTP) ~ 0.001 * (k_gs_lo * beta_cav_RGs_tot + k_gs_hi * beta_cav_LRGs_tot -
                                        k_gtp_gs * beta_cav_Gs_aGTP)

        D(beta_cav_Gi_aGTP) ~ 0.001 * (k_gi_lo * beta_cav_Rb2Gi + k_gi_hi * beta_cav_LRb2Gi -
                                        k_gtp_gi * beta_cav_Gi_aGTP)

        D(beta_eca_Gs_aGTP) ~ 0.001 * (k_gs_lo * beta_eca_RGs_tot + k_gs_hi * beta_eca_LRGs_tot -
                                        k_gtp_gs * beta_eca_Gs_aGTP)

        D(beta_eca_Gi_aGTP) ~ 0.001 * (k_gi_lo * beta_eca_Rb2Gi + k_gi_hi * beta_eca_LRb2Gi -
                                        k_gtp_gi * beta_eca_Gi_aGTP)

        D(beta_cyt_Gs_aGTP) ~ 0.001 * (k_gs_lo * Rb1Gs_np + k_gs_hi * LRb1Gs_np -
                                        k_gtp_gs * beta_cyt_Gs_aGTP)

        # Gs reassociation
        D(beta_cav_Gs_bg) ~ 0.001 * (k_gs_lo * beta_cav_RGs_tot + k_gs_hi * beta_cav_LRGs_tot -
                                      k_reassoc_gs * beta_cav_Gs_bg * beta_cav_Gs_aGDP)

        D(beta_cav_Gi_bg) ~ 0.001 * (k_gi_lo * beta_cav_Rb2Gi + k_gi_hi * beta_cav_LRb2Gi -
                                      k_reassoc_gi * beta_cav_Gi_bg * beta_cav_Gi_aGDP)

        D(beta_eca_Gs_bg) ~ 0.001 * (k_gs_lo * beta_eca_RGs_tot + k_gs_hi * beta_eca_LRGs_tot -
                                      k_reassoc_gs * beta_eca_Gs_bg * beta_eca_Gs_aGDP)

        D(beta_eca_Gi_bg) ~ 0.001 * (k_gi_lo * beta_eca_Rb2Gi + k_gi_hi * beta_eca_LRb2Gi -
                                      k_reassoc_gi * beta_eca_Gi_bg * beta_eca_Gi_aGDP)

        D(beta_cyt_Gs_bg) ~ 0.001 * (k_gs_lo * Rb1Gs_np + k_gs_hi * LRb1Gs_np -
                                      k_reassoc_gs * beta_cyt_Gs_bg * beta_cyt_Gs_aGDP)

        # GDP accumulation
        D(beta_cav_Gs_aGDP) ~ 0.001 * (k_gtp_gs * beta_cav_Gs_aGTP -
                                        k_reassoc_gs * beta_cav_Gs_bg * beta_cav_Gs_aGDP)

        D(beta_cav_Gi_aGDP) ~ 0.001 * (k_gtp_gi * beta_cav_Gi_aGTP -
                                        k_reassoc_gi * beta_cav_Gi_bg * beta_cav_Gi_aGDP)

        D(beta_eca_Gs_aGDP) ~ 0.001 * (k_gtp_gs * beta_eca_Gs_aGTP -
                                        k_reassoc_gs * beta_eca_Gs_bg * beta_eca_Gs_aGDP)

        D(beta_eca_Gi_aGDP) ~ 0.001 * (k_gtp_gi * beta_eca_Gi_aGTP -
                                        k_reassoc_gi * beta_eca_Gi_bg * beta_eca_Gi_aGDP)

        D(beta_cyt_Gs_aGDP) ~ 0.001 * (k_gtp_gs * beta_cyt_Gs_aGTP -
                                        k_reassoc_gs * beta_cyt_Gs_bg * beta_cyt_Gs_aGDP)

        ## PKA ACTIVATION ##
        # Caveolar
        pka_cav_RCf ~ PKA_cav - pka_cav_ARC - pka_cav_A2RC - pka_cav_A2R

        D(pka_cav_ARC) ~ 0.001 * (k_pka_f1 * pka_cav_RCf * cAMP_cav -
                                   k_pka_cav_b1 * pka_cav_ARC -
                                   k_pka_f2 * pka_cav_ARC * cAMP_cav +
                                   k_pka_cav_b2 * pka_cav_A2RC)

        D(pka_cav_A2RC) ~ 0.001 * (k_pka_f2 * pka_cav_ARC * cAMP_cav -
                                    (k_pka_cav_b2 + k_pka_f3) * pka_cav_A2RC +
                                    k_pka_cav_b3 * pka_cav_A2R * pka_cav_C)

        D(pka_cav_A2R) ~ 0.001 * (k_pka_f3 * pka_cav_A2RC - k_pka_cav_b3 * pka_cav_A2R * pka_cav_C)

        D(pka_cav_C) ~ 0.001 * (k_pka_f3 * pka_cav_A2RC -
                                 k_pka_cav_b3 * pka_cav_A2R * pka_cav_C +
                                 k_pki_b * pka_cav_PKIC -
                                 k_pki_f * (PKI_cav - pka_cav_PKIC) * pka_cav_C)

        D(pka_cav_PKIC) ~ 0.001 * (k_pki_f * (PKI_cav - pka_cav_PKIC) * pka_cav_C -
                                    k_pki_b * pka_cav_PKIC)

        # Extracaveolar
        pka_eca_RCf ~ PKA_eca - pka_eca_ARC - pka_eca_A2RC - pka_eca_A2R

        D(pka_eca_ARC) ~ 0.001 * (k_pka_f1 * pka_eca_RCf * cAMP_eca -
                                   k_pka_eca_b1 * pka_eca_ARC -
                                   k_pka_f2 * pka_eca_ARC * cAMP_eca +
                                   k_pka_eca_b2 * pka_eca_A2RC)

        D(pka_eca_A2RC) ~ 0.001 * (k_pka_f2 * pka_eca_ARC * cAMP_eca -
                                    (k_pka_eca_b2 + k_pka_f3) * pka_eca_A2RC +
                                    k_pka_eca_b3 * pka_eca_A2R * pka_eca_C)

        D(pka_eca_A2R) ~ 0.001 * (k_pka_f3 * pka_eca_A2RC - k_pka_eca_b3 * pka_eca_A2R * pka_eca_C)

        D(pka_eca_C) ~ 0.001 * (k_pka_f3 * pka_eca_A2RC -
                                 k_pka_eca_b3 * pka_eca_A2R * pka_eca_C +
                                 k_pki_b * pka_eca_PKIC -
                                 k_pki_f * (PKI_eca - pka_eca_PKIC) * pka_eca_C)

        D(pka_eca_PKIC) ~ 0.001 * (k_pki_f * (PKI_eca - pka_eca_PKIC) * pka_eca_C -
                                    k_pki_b * pka_eca_PKIC)

        # Cytosolic
        pka_cyt_RCf ~ PKA_cyt - pka_cyt_ARC - pka_cyt_A2RC - pka_cyt_A2R

        D(pka_cyt_ARC) ~ 0.001 * (k_pka_f1 * pka_cyt_RCf * cAMP_cyt -
                                   k_pka_cyt_b1 * pka_cyt_ARC -
                                   k_pka_f2 * pka_cyt_ARC * cAMP_cyt +
                                   k_pka_cyt_b2 * pka_cyt_A2RC)

        D(pka_cyt_A2RC) ~ 0.001 * (k_pka_f2 * pka_cyt_ARC * cAMP_cyt -
                                    (k_pka_cyt_b2 + k_pka_f3) * pka_cyt_A2RC +
                                    k_pka_cyt_b3 * pka_cyt_A2R * pka_cyt_C)

        D(pka_cyt_A2R) ~ 0.001 * (k_pka_f3 * pka_cyt_A2RC - k_pka_cyt_b3 * pka_cyt_A2R * pka_cyt_C)

        D(pka_cyt_C) ~ 0.001 * (k_pka_f3 * pka_cyt_A2RC -
                                 k_pka_cyt_b3 * pka_cyt_A2R * pka_cyt_C +
                                 k_pki_b * pka_cyt_PKIC -
                                 k_pki_f * (PKI_cyt - pka_cyt_PKIC) * pka_cyt_C)

        D(pka_cyt_PKIC) ~ 0.001 * (k_pki_f * (PKI_cyt - pka_cyt_PKIC) * pka_cyt_C -
                                    k_pki_b * pka_cyt_PKIC)

        ## cAMP DYNAMICS ##
        # PKA consumption of cAMP
        pka_cav_dcAMP ~ (-k_pka_f1 * pka_cav_RCf * cAMP_cav +
                         k_pka_cav_b1 * pka_cav_ARC -
                         k_pka_f2 * pka_cav_ARC * cAMP_cav +
                         k_pka_cav_b2 * pka_cav_A2RC)

        pka_eca_dcAMP ~ (-k_pka_f1 * pka_eca_RCf * cAMP_eca +
                         k_pka_eca_b1 * pka_eca_ARC -
                         k_pka_f2 * pka_eca_ARC * cAMP_eca +
                         k_pka_eca_b2 * pka_eca_A2RC)

        pka_cyt_dcAMP ~ (-k_pka_f1 * pka_cyt_RCf * cAMP_cyt +
                         k_pka_cyt_b1 * pka_cyt_ARC -
                         k_pka_f2 * pka_cyt_ARC * cAMP_cyt +
                         k_pka_cyt_b2 * pka_cyt_A2RC)

        # PDE hydrolysis
        dcAMP_PDE2_cyt ~ k_pde2 * PDE2_cyt / (1.0 + Km_pde2 / cAMP_cyt)
        dcAMP_PDE2_eca ~ k_pde2 * PDE2_eca / (1.0 + Km_pde2 / cAMP_eca)
        dcAMP_PDE2_cav ~ k_pde2 * PDE2_cav / (1.0 + Km_pde2 / cAMP_cav)

        dcAMP_PDE3_cav ~ (PDE3_cav + (pde_phos_factor - 1.0) * PDE3_P_cav) * k_pde3 / (1.0 + Km_pde3 / cAMP_cav)
        dcAMP_PDE3_cyt ~ (PDE3_cyt + (pde_phos_factor - 1.0) * PDE3_P_cyt) * k_pde3 / (1.0 + Km_pde3 / cAMP_cyt)

        dcAMP_PDE4_cyt ~ (PDE4_cyt + (pde_phos_factor - 1.0) * PDE4_P_cyt) * k_pde4 / (1.0 + Km_pde4 / cAMP_cyt)
        dcAMP_PDE4_eca ~ (PDE4_eca + (pde_phos_factor - 1.0) * PDE4_P_eca) * k_pde4 / (1.0 + Km_pde4 / cAMP_eca)
        dcAMP_PDE4_cav ~ (PDE4_cav + (pde_phos_factor - 1.0) * PDE4_P_cav) * k_pde4 / (1.0 + Km_pde4 / cAMP_cav)

        camp_cAMP_cyt_pde ~ dcAMP_PDE2_cyt + dcAMP_PDE3_cyt + dcAMP_PDE4_cyt
        camp_cAMP_cyt_j1 ~ k_cav_cyt * (cAMP_cav - cAMP_cyt) / V_cyt
        camp_cAMP_cyt_j2 ~ k_eca_cyt * (cAMP_eca - cAMP_cyt) / V_cyt

        camp_cAMP_eca_pde ~ dcAMP_PDE2_eca + dcAMP_PDE4_eca
        camp_cAMP_eca_j2 ~ k_eca_cyt * (cAMP_eca - cAMP_cyt) / V_eca
        camp_cAMP_eca_j1 ~ k_cav_eca * (cAMP_cav - cAMP_eca) / V_eca

        camp_cAMP_cav_pde ~ dcAMP_PDE2_cav + dcAMP_PDE3_cav + dcAMP_PDE4_cav
        camp_cAMP_cav_j2 ~ k_cav_cyt * (cAMP_cav - cAMP_cyt) / V_cav
        camp_cAMP_cav_j1 ~ k_cav_eca * (cAMP_cav - cAMP_eca) / V_cav

        # AC synthesis
        ac_kAC47_cyt_gsa ~ beta_cyt_Gs_aGTP^hill_ac47
        kAC47_cyt ~ amp_ac47 * (basal_ac47 + ac_kAC47_cyt_gsa / (Km_ac47_gs + ac_kAC47_cyt_gsa))

        ac_kAC56_cav_gsa ~ beta_cav_Gs_aGTP^hill_ac56
        gsi ~ beta_cav_Gs_aGTP^hill_gi_ac56
        kAC56_cav ~ (amp_ac56 * (basal_ac56 + ac_kAC56_cav_gsa / (Km_ac56_gs + ac_kAC56_cav_gsa)) *
                     (1.0 - (1.0 - gi_inhibition * gsi / (Km_gs_gi_ac56 + gsi)) *
                      beta_cav_Gi_bg / (Km_ac56_gi + beta_cav_Gi_bg)))

        ac_kAC47_eca_gsa ~ beta_eca_Gs_aGTP^hill_ac47
        kAC47_eca ~ amp_ac47 * (basal_ac47 + ac_kAC47_eca_gsa / (Km_ac47_gs + ac_kAC47_eca_gsa))

        ac_kAC56_cyt_gsa ~ beta_cyt_Gs_aGTP^hill_ac56
        kAC56_cyt ~ amp_ac56 * (basal_ac56 + ac_kAC56_cyt_gsa / (Km_ac56_gs + ac_kAC56_cyt_gsa))

        dcAMP_AC47_cyt ~ kAC47_cyt * AC56_cyt * f_atp
        dcAMP_AC56_cyt ~ kAC56_cyt * AC56_cyt2 * f_atp
        dcAMP_AC56_cav ~ kAC56_cav * AC56_cav * f_atp
        dcAMP_AC47_eca ~ kAC47_eca * AC47_eca * f_atp

        # cAMP balance
        D(cAMP_cav) ~ 0.001 * (pka_cav_dcAMP + dcAMP_AC56_cav - camp_cAMP_cav_pde -
                               camp_cAMP_cav_j1 - camp_cAMP_cav_j2)

        D(cAMP_eca) ~ 0.001 * (pka_eca_dcAMP + dcAMP_AC47_eca - camp_cAMP_eca_pde +
                               camp_cAMP_eca_j1 - camp_cAMP_eca_j2)

        D(cAMP_cyt) ~ 0.001 * (pka_cyt_dcAMP + dcAMP_AC47_cyt + dcAMP_AC56_cyt -
                               camp_cAMP_cyt_pde + camp_cAMP_cyt_j1 + camp_cAMP_cyt_j2)

        ## PDE PHOSPHORYLATION ##
        D(PDE3_P_cav) ~ 0.001 * (k_pde_phos * pka_cav_C * (PDE3_cav - PDE3_P_cav) -
                                 k_pde_dephos * PDE3_P_cav)

        D(PDE3_P_cyt) ~ 0.001 * (k_pde_phos * pka_cyt_C * (PDE3_cyt - PDE3_P_cyt) -
                                 k_pde_dephos * PDE3_P_cyt)

        D(PDE4_P_cav) ~ 0.001 * (k_pde_phos * pka_cav_C * (PDE4_cav - PDE4_P_cav) -
                                 k_pde_dephos * PDE4_P_cav)

        D(PDE4_P_eca) ~ 0.001 * (k_pde_phos * pka_eca_C * (PDE4_eca - PDE4_P_eca) -
                                 k_pde_dephos * PDE4_P_eca)

        D(PDE4_P_cyt) ~ 0.001 * (k_pde_phos * pka_cyt_C * (PDE4_cyt - PDE4_P_cyt) -
                                 k_pde_dephos * PDE4_P_cyt)

        ## PP1 INHIBITION ##
        pp1_PP1f_cyt_sum ~ PP1_cyt - Kd_pp1 + inhib1_p
        PP1f_cyt ~ 0.5 * (sqrt(pp1_PP1f_cyt_sum^2.0 + 4.0 * PP1_cyt * Kd_pp1) - pp1_PP1f_cyt_sum)
        di ~ inhib1_tot - inhib1_p

        D(inhib1_p) ~ 0.001 * (k_pp1_f * pka_cyt_C * di / (Km_pki + di) -
                               k_pp1_b * PP2A * inhib1_p / (Km_pp2a + inhib1_p))

        ## CHANNEL PHOSPHORYLATION ##
        # Substrates without AKAP
        D(iup_f_plb) ~ 0.001 * (k_plb_phos * pka_cyt_C * (1.0 - iup_f_plb_clamped) /
                                 (Km_plb_phos + 1.0 - iup_f_plb_clamped) -
                                 k_plb_dephos * PP1f_cyt * iup_f_plb_clamped /
                                 (Km_plb_dephos + iup_f_plb_clamped))

        D(f_tni) ~ 0.001 * (k_tni_phos * pka_cyt_C * (1.0 - f_tni_clamped) /
                             (Km_tni_phos + 1.0 - f_tni_clamped) -
                             k_tni_dephos * PP2A * f_tni_clamped /
                             (Km_tni_dephos + f_tni_clamped))

        D(ina_f_ina) ~ 0.001 * (k_ina_phos * pka_cav_C * (1.0 - ina_f_ina_clamped) /
                                 (Km_ina_phos + 1.0 - ina_f_ina_clamped) -
                                 k_ina_dephos * PP1_cav * ina_f_ina_clamped /
                                 (Km_ina_dephos + ina_f_ina_clamped))

        D(f_inak) ~ 0.001 * (k_inak_phos * pka_cav_C * (1.0 - f_inak_clamped) /
                              (Km_inak_phos + 1.0 - f_inak_clamped) -
                              k_inak_dephos * PP1_cav * f_inak_clamped /
                              (Km_inak_dephos + f_inak_clamped))

        D(f_ikur) ~ 0.001 * (k_ikur_phos * pka_eca_C * (1.0 - f_ikur_clamped) /
                              (Km_ikur_phos + 1.0 - f_ikur_clamped) -
                              k_ikur_dephos * PP1_eca * f_ikur_clamped /
                              (Km_ikur_dephos + f_ikur_clamped))

        # Substrates with AKAP
        iks_sig_IKsp_dif ~ IKs_tot_akap - IKsp
        D(IKsp) ~ 0.001 * (k_iks_phos * pka_eca_C * iks_sig_IKsp_dif /
                            (Km_iks_phos + iks_sig_IKsp_dif) -
                            k_iks_dephos * PP1_eca * IKsp /
                            (Km_iks_dephos + IKsp))

        akap_sig_RyRp_dif ~ RyR_tot_akap - RyRp
        D(RyRp) ~ 0.001 * (k_ryr_phos * pka_cav_C * akap_sig_RyRp_dif /
                            (Km_ryr_phos + akap_sig_RyRp_dif) -
                            k_ryr_dephos * PP1_cav * RyRp /
                            (Km_ryr_dephos + RyRp))

        akap_sig_ICaLp_dif ~ ICaL_tot_akap - ICaLp
        D(ICaLp) ~ 0.001 * (k_ical_phos * pka_cav_C * akap_sig_ICaLp_dif /
                             (Km_ical_phos + akap_sig_ICaLp_dif) -
                             k_ical_dephos * PP1_cav * ICaLp /
                             (Km_ical_dephos + ICaLp))
    end  # end of @equations block
end  # end of @mtkmodel
